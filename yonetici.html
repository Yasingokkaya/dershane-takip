<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netici Kontrol Merkezi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="manifest" href="manifest.json">
    
    <link rel="icon" type="image/jpeg" href="logo.jpeg">
    
    <link rel="apple-touch-icon" href="logo.jpeg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4e54c8">
   <style>
        /* Sekmelerin GENEL yapÄ±sÄ± ve EÅŸit GeniÅŸlik AyarÄ± */
        .nav-tabs {
            border-bottom: none; /* Alt Ã§izgiyi kaldÄ±r */
            gap: 10px; /* DÃ¼ÄŸmeler arasÄ± boÅŸluk */
            display: flex; /* Esnek kutu yapÄ±sÄ± */
            width: 100%; /* Tam geniÅŸlik */
        }

        .nav-tabs .nav-item {
            flex: 1; /* BU SATIR TÃœM KUTULARI EÅžÄ°T GENÄ°ÅžLÄ°ÄžE ZORLAR */
            text-align: center; /* YazÄ±larÄ± ortalar */
        }

        .nav-tabs .nav-link {
            width: 100%; /* Linkin kutuyu tamamen doldurmasÄ±nÄ± saÄŸlar */
            border-radius: 10px; /* KÃ¶ÅŸeleri yuvarla */
            font-weight: bold;
            border: 1px solid rgba(0,0,0,0.1);
            background-color: white;
            color: #6c757d; /* Pasifken gri yazÄ± */
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Hafif gÃ¶lge */
            white-space: nowrap; /* YazÄ±larÄ±n alt satÄ±ra kaymasÄ±nÄ± engeller */
        }

        /* 1. ONAY BEKLEYENLER (Turuncu - UyarÄ± Rengi) */
        .nav-tabs .nav-item:nth-child(1) .nav-link.active,
        .nav-tabs .nav-item:nth-child(1) .nav-link:hover {
            background-color: #ffca2c !important; 
            color: #000 !important;
            border-color: #ffc720;
        }
        .nav-tabs .nav-item:nth-child(1) .nav-link { border-bottom: 4px solid #ffca2c; }


        /* 2. RAPORLAR (Mavi - Bilgi Rengi) */
        .nav-tabs .nav-item:nth-child(2) .nav-link.active,
        .nav-tabs .nav-item:nth-child(2) .nav-link:hover {
            background-color: #0dcaf0 !important;
            color: #000 !important;
            border-color: #0aa2c0;
        }
        .nav-tabs .nav-item:nth-child(2) .nav-link { border-bottom: 4px solid #0dcaf0; }


        /* 3. MUHASEBE (YeÅŸil - Para Rengi) */
        .nav-tabs .nav-item:nth-child(3) .nav-link.active,
        .nav-tabs .nav-item:nth-child(3) .nav-link:hover {
            background-color: #198754 !important;
            color: white !important;
            border-color: #157347;
        }
        .nav-tabs .nav-item:nth-child(3) .nav-link { border-bottom: 4px solid #198754; }


        /* 4. PERSONEL YÃ–NETÄ°MÄ° (Mor - YÃ¶netim Rengi) */
        .nav-tabs .nav-item:nth-child(4) .nav-link.active,
        .nav-tabs .nav-item:nth-child(4) .nav-link:hover {
            background-color: #6610f2 !important;
            color: white !important;
            border-color: #520dc2;
        }
        .nav-tabs .nav-item:nth-child(4) .nav-link { border-bottom: 4px solid #6610f2; }

/* YAZDIRMA AYARLARI (DÃœZELTÄ°LDÄ°: Ã‡AKIÅžMAYI Ã–NLER) */
        @media print {
            body * { 
                visibility: hidden; /* Her ÅŸeyi gizle */
            }
            
            /* SADECE "d-none" sÄ±nÄ±fÄ± OLMAYAN (yani o an aÃ§Ä±k olan) alanÄ± gÃ¶ster */
            #makbuzAlani:not(.d-none), 
            #ekstreAlani:not(.d-none) { 
                visibility: visible !important;
                display: block !important; 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                margin: 0; 
                padding: 20px;
                background-color: white;
                z-index: 9999;
                /* Renkleri zorla */
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
            }

            /* AÃ§Ä±k olan kutunun Ä°Ã‡Ä°NDEKÄ°LERÄ° de gÃ¶ster */
            #makbuzAlani:not(.d-none) *, 
            #ekstreAlani:not(.d-none) * { 
                visibility: visible !important; 
            }

            /* Gereksiz kenar boÅŸluklarÄ±nÄ± sÄ±fÄ±rla */
            @page { margin: 0; size: auto; }

            /* Tablo TasarÄ±mÄ± */
            .custom-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            .custom-table th { background-color: #f0f0f0 !important; color: #000; padding: 10px; border-bottom: 2px solid #000; text-align: left; }
            .custom-table td { padding: 8px; border-bottom: 1px solid #ddd; }
            .text-end-print { text-align: right !important; }
        }
        /* --- YENÄ° EKLENECEK PREMIUM & MOBÄ°L CSS --- */

        /* 1. Arka PlanÄ± Hareketli Yap */
        body {
            background: linear-gradient(-45deg, #1e3c72, #2a5298, #23d5ab, #23a6d5);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. Kartlara Buzlu Cam Efekti Ver */
        .card {
            background: rgba(255, 255, 255, 0.9) !important; /* Hafif ÅŸeffaf */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15) !important;
            border-radius: 15px !important;
        }

        /* 3. MenÃ¼yÃ¼ GÃ¼zelleÅŸtir */
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* 4. MOBÄ°L Ä°Ã‡Ä°N YATAY KAYDIRILABÄ°LÄ°R SEKMELER (EN Ã–NEMLÄ° KISIM) */
        .nav-tabs {
            flex-wrap: nowrap !important; /* Alt satÄ±ra dÃ¼ÅŸmesini engelle */
            overflow-x: auto !important; /* Yana kaydÄ±r */
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 5px;
            gap: 10px;
            border-bottom: none;
        }
        
        /* Sekme ButonlarÄ±nÄ± Hap Åžeklinde Yap */
        .nav-tabs .nav-link {
            border-radius: 50px !important;
            background-color: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.1);
            color: #555;
            padding: 8px 20px;
            font-size: 0.9rem;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(45deg, #4776E6, #8E54E9) !important;
            color: white !important;
            border: none;
            box-shadow: 0 4px 15px rgba(71, 118, 230, 0.4);
        }

        /* Scroll Ã§ubuÄŸunu gizle (Daha temiz gÃ¶rÃ¼nÃ¼m iÃ§in) */
        .nav-tabs::-webkit-scrollbar { display: none; }
        /* Ã‡Ä±kÄ±ÅŸ Butonu Ã–zel Efekti */
        .btn-cikis {
            transition: all 0.3s ease;
            border-radius: 50px; /* Yuvarlak hatlar */
            font-weight: bold;
            padding: 5px 20px;
        }
        .btn-cikis:hover {
            background-color: #dc3545;
            color: white;
            transform: scale(1.1); /* Hafif bÃ¼yÃ¼me */
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.6); /* KÄ±rmÄ±zÄ± neon parlama */
        }
    </style>
    </style>
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand navbar-light mb-4 sticky-top">
        <div class="container-fluid px-3">
            
            <a class="navbar-brand d-flex align-items-center text-primary fw-bold" href="#">
                <img src="logo.jpeg" alt="Logo" width="35" height="35" class="d-inline-block align-text-top rounded-3 shadow-sm me-2">
                <span class="d-none d-sm-inline">YÃ¶netici Paneli</span>
                <span class="d-inline d-sm-none fs-6">YÃ¶netici</span> </a>

            <div class="d-flex align-items-center ms-auto">
                <span class="text-dark me-2 fw-bold small d-none d-md-block" id="kullaniciBilgi"></span>
                <button onclick="cikisYap()" class="btn btn-outline-danger btn-sm rounded-pill px-3 ms-1">
                    <i class="bi bi-power"></i> <span class="d-none d-sm-inline">Ã‡Ä±kÄ±ÅŸ</span>
                </button>
            </div>
        </div>
    </nav>
</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#onay">
                    ðŸ”” Onay <span id="badgeSayi" class="badge bg-light text-danger rounded-pill ms-1">0</span>
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#rapor">
                    ðŸ“Š Raporlar
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#muhasebe">
                    ðŸ’° Muhasebe
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#personel">
                    ðŸ‘¥ Personel
                </button>
            </li>
        </ul>

        <div class="tab-content">
            
            <div class="tab-pane fade show active" id="onay">
                <div class="card shadow-sm border-0"><div class="card-body p-0"><table class="table table-hover table-striped mb-0 text-center align-middle"><thead class="table-dark"><tr><th>Ã–ÄŸretmen</th><th>Tarih</th><th>Ders</th><th>SÃ¼re</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="bekleyenTablo"><tr><td colspan="5" class="p-4">YÃ¼kleniyor...</td></tr></tbody></table></div></div>
            </div>

            <div class="tab-pane fade" id="rapor">
                <div class="card shadow-sm border-0"><div class="card-body">
                    <div class="row g-2 mb-3">
    <div class="col-md-3">
        <select id="filtreAd" class="form-select">
            <option value="">TÃ¼m Ã–ÄŸretmenler</option>
        </select>
    </div>
    <div class="col-md-3"><input type="date" id="baslangicTarih" class="form-control"></div>
    <div class="col-md-3"><input type="date" id="bitisTarih" class="form-control"></div>
    <div class="col-md-3"><button onclick="raporGetir()" class="btn btn-primary w-100">Listele</button></div>
</div>

<div class="table-responsive">
    <table class="table table-bordered table-sm text-center align-middle">
        <thead class="table-secondary">
            <tr>
                <th>Tarih</th>
                <th>Ã–ÄŸretmen</th>
                <th>Ders</th>
                <th>SÃ¼re</th>
                <th>Birim Fiyat</th>
                <th>Tutar</th>
                <th>Ä°ÅŸlemler</th> 
            </tr>
        </thead>
        <tbody id="raporTablo"><tr><td colspan="7">Veri yok.</td></tr></tbody>
    </table>
</div>
                </div></div>
            </div>

            <div class="tab-pane fade" id="muhasebe">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card shadow border-0 mb-3">
                            <div class="card-header bg-success text-white">ðŸ§® Hesap SeÃ§imi</div>
                            <div class="card-body">
                                <label>Ã–ÄŸretmen SeÃ§in:</label>
                                <select id="muhasebeOgretmen" class="form-select mb-3" onchange="hesapOzetiniGetir()"></select>
                                <div class="d-grid gap-2">
                                    <button onclick="hesapOzetiniGetir()" class="btn btn-outline-primary">HesabÄ± GÃ¼ncelle</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card shadow border-0">
                            <div class="card-header bg-warning text-dark">ðŸ’¸ Ã–deme Yap</div>
                            <div class="card-body">
    <label class="small text-muted">Ã–deme Tarihi</label>
    <input type="date" id="odemeTarih" class="form-control mb-2">
    
    <label class="small text-muted">Tutar (TL)</label>
    <input type="number" id="odemeMiktar" class="form-control mb-2" placeholder="0.00">
    
    <label class="small text-muted">AÃ§Ä±klama</label>
    <input type="text" id="odemeAciklama" class="form-control mb-2" placeholder="Ã–rn: KasÄ±m MaaÅŸÄ±">
    
    <button onclick="odemeYap()" class="btn btn-success w-100">Ã–demeyi Kaydet ve Makbuz Kes</button>
</div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="row text-center mb-4">
                            <div class="col-md-4"><div class="card bg-light border-primary"><div class="card-body"><h6 class="text-primary">Toplam Hak EdiÅŸ</h6><h3 id="lblHakedis">0 â‚º</h3></div></div></div>
                            <div class="col-md-4"><div class="card bg-light border-success"><div class="card-body"><h6 class="text-success">Toplam Ã–denen</h6><h3 id="lblOdenen">0 â‚º</h3></div></div></div>
                            <div class="col-md-4"><div class="card bg-light border-danger"><div class="card-body"><h6 class="text-danger">Kalan Bakiye</h6><h3 id="lblKalan">0 â‚º</h3></div></div></div>
                        </div>

                        <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">ðŸ“‹ Son Hesap Hareketleri</h6>
        <button onclick="ekstreYazdir()" class="btn btn-sm btn-dark">
            <i class="bi bi-printer-fill"></i> DÃ¶kÃ¼mÃ¼ YazdÄ±r
        </button>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0 text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>Tarih</th>
                    <th>AÃ§Ä±klama</th>
                    <th>Ã–deme TutarÄ±</th>
                    <th>Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody id="hareketListesi">
                <tr><td colspan="4" class="text-muted p-3">Ã–ÄŸretmen seÃ§iniz...</td></tr>
            </tbody>
        </table>
    </div>
</div>
                    </div>
                </div>
            </div>
         <div id="ekstreAlani" class="d-none bg-white p-5">
    
    <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4">
        <div>
            <h2 class="fw-bold mb-0">HESAP EKSTRESÄ°</h2>
            <small class="text-muted">BalÄ±klÄ± EÄŸitim KurumlarÄ±</small>
        </div>
        <div class="text-end">
            <h5 class="mb-0 text-muted">Tarih</h5>
            <span id="ekstreTarih" class="fw-bold fs-5"></span>
        </div>
    </div>
    
    <div class="mb-4">
        <span class="text-muted small">SayÄ±n:</span>
        <h4 id="ekstreAd" class="fw-bold text-primary m-0"></h4>
    </div>

    <div class="row g-0 mb-5 border rounded overflow-hidden text-center" style="background-color: #f8f9fa;">
        <div class="col-4 p-3 border-end">
            <small class="text-muted d-block mb-1">TOPLAM HAK EDÄ°Åž</small>
            <h3 id="printHakedis" class="fw-bold text-primary m-0"></h3>
        </div>
        <div class="col-4 p-3 border-end">
            <small class="text-muted d-block mb-1">TOPLAM Ã–DENEN</small>
            <h3 id="printOdenen" class="fw-bold text-success m-0"></h3>
        </div>
        <div class="col-4 p-3" style="background-color: #fff3cd;">
            <small class="text-muted d-block mb-1">KALAN BAKÄ°YE</small>
            <h3 id="printKalan" class="fw-bold text-danger m-0"></h3>
        </div>
    </div>
    
    <table class="custom-table">
        <colgroup>
            <col style="width: 20%;"> <col style="width: 60%;"> <col style="width: 20%;"> </colgroup>
        <thead>
            <tr>
                <th>TARÄ°H</th>
                <th>AÃ‡IKLAMA</th>
                <th class="text-end-print">TUTAR</th>
            </tr>
        </thead>
        <tbody id="ekstreTabloBody">
            </tbody>
    </table>

    <div class="mt-5 text-center text-muted small fst-italic">
        <p>Bu belge bilgisayar ortamÄ±nda oluÅŸturulmuÅŸtur ve Ä±slak imza gerektirmez.</p>
        <p>TeÅŸekkÃ¼r ederiz.</p>
    </div>
</div>
            <div class="tab-pane fade" id="personel">
                <div class="row justify-content-center">
                    <div class="col-md-5 mb-3">
                        <div class="card shadow border-0 h-100">
                            <div class="card-header bg-primary text-white"><h5 class="mb-0">âž• Yeni Ã‡alÄ±ÅŸan Ekle</h5></div>
                            <div class="card-body">
                                <form id="personelForm">
                                    <div class="mb-2"><input type="text" id="yeniAd" class="form-control" placeholder="Ad Soyad" required></div>
                                    <div class="mb-2"><input type="email" id="yeniEmail" class="form-control" placeholder="E-Posta" required></div>
                                    <div class="mb-2"><input type="text" id="yeniSifre" class="form-control" placeholder="Åžifre" required></div>
                                    <div class="mb-2">
                                        <label class="small text-muted">Saatlik Ãœcret (TL)</label>
                                        <input type="number" id="yeniUcret" class="form-control" placeholder="Ã–rn: 500" required>
                                    </div>
                                    <div class="mb-3"><select id="yeniRol" class="form-select"><option value="ogretmen">Ã–ÄŸretmen</option><option value="yonetici">YÃ¶netici</option></select></div>
                                    <button type="submit" class="btn btn-success w-100">Kaydet</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7"><div class="card shadow border-0"><div class="card-header bg-secondary text-white"><h5 class="mb-0">ðŸ“‹ Mevcut KullanÄ±cÄ±lar</h5></div><div class="card-body p-0"><ul class="list-group list-group-flush" id="kullaniciListesi"><li class="list-group-item text-center">YÃ¼kleniyor...</li></ul></div></div></div>
                </div>
            </div>
        </div>
    </div>


<div id="makbuzAlani" class="d-none bg-white">
    <div class="container mt-4" style="max-width: 210mm; border: 2px solid #000; padding: 0;">
        
        <div class="d-flex justify-content-between align-items-center p-4 border-bottom border-dark" style="background-color: #f0f0f0;">
            <div class="d-flex align-items-center">
                <i class="bi bi-building-check fs-1 me-3"></i>
                <div>
                    <h2 class="fw-bold m-0" style="letter-spacing: 1px;">Ã–DEME MAKBUZU</h2>
                    <small class="text-uppercase text-muted fw-bold">BalÄ±klÄ± EÄŸitim KurumlarÄ±</small>
                </div>
            </div>
            <div class="text-end">
                <span class="d-block small fw-bold text-muted">TARÄ°H</span>
                <span id="mkbTarih" class="fs-4 fw-bold text-dark font-monospace"></span>
            </div>
        </div>

        <div class="p-4">
            <div class="row mb-3">
                <div class="col-8">
                    <label class="small text-muted fw-bold mb-1">SAYIN / ALICI:</label>
                    <div id="mkbAd" class="fs-5 fw-bold border-bottom border-secondary pb-1"></div>
                </div>
                <div class="col-4">
                     <label class="small text-muted fw-bold mb-1">Ä°ÅžLEM TÃœRÃœ:</label>
                     <div class="fs-6 border-bottom border-secondary pb-1">Nakit Ã–deme</div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-12">
                    <label class="small text-muted fw-bold mb-1">AÃ‡IKLAMA:</label>
                    <div id="mkbAciklama" class="fst-italic border-bottom border-secondary pb-1"></div>
                </div>
            </div>

            <div class="row mx-0 border border-dark rounded" style="background-color: #f8f9fa;">
                <div class="col-9 d-flex align-items-center p-3 border-end border-dark">
                    <span class="fw-bold text-muted me-2 small">YALNIZ;</span>
                    <span id="mkbYazi" class="fw-bold text-dark text-uppercase" style="letter-spacing: 0.5px;"></span>
                </div>
                <div class="col-3 d-flex align-items-center justify-content-end p-3 bg-white rounded-end">
                    <span class="fs-3 fw-bold text-dark" id="mkbTutar"></span>
                    <span class="fs-5 fw-bold ms-1">â‚º</span>
                </div>
            </div>
        </div>

        <div class="row p-4 mt-2">
            <div class="col-4 text-center">
                <small class="fw-bold d-block mb-1 text-decoration-underline">TESLÄ°M EDEN (1)</small>
                <small class="text-muted">Muhasebe</small>
                <div style="height: 50px; border-bottom: 1px dashed #000; margin-top: 10px;"></div>
            </div>
            
            <div class="col-4 text-center border-start border-end">
                <small class="fw-bold d-block mb-1 text-decoration-underline">TESLÄ°M EDEN (2)</small>
                <small class="text-muted">Kurum MÃ¼dÃ¼rÃ¼</small>
                <div style="height: 50px; border-bottom: 1px dashed #000; margin-top: 10px;"></div>
            </div>

            <div class="col-4 text-center">
                <small class="fw-bold d-block mb-1 text-decoration-underline">TESLÄ°M ALAN</small>
                <small class="text-muted">Ad Soyad / Ä°mza</small>
                <div style="height: 50px; border-bottom: 1px dashed #000; margin-top: 10px;"></div>
            </div>
        </div>
        
        <div class="text-center py-2 bg-light border-top border-dark small text-muted">
            
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc, deleteDoc, orderBy, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

       
        const firebaseConfig = {
  apiKey: "AIzaSyCWi2T41yWD2uQz5leN2w1v-0lk6dk_AWM",
  authDomain: "dershanetakip-34d23.firebaseapp.com",
  projectId: "dershanetakip-34d23",
  storageBucket: "dershanetakip-34d23.firebasestorage.app",
  messagingSenderId: "614841525540",
  appId: "1:614841525540:web:2851108451bb4ef0e4bfb1",
  measurementId: "G-RKQH5SZN43"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GÃœVENLÄ° Ã‡IKIÅž Ä°ÅžLEMÄ° (MODERN) ---
        window.cikisYap = function() {
            Swal.fire({
                title: 'Ã‡Ä±kÄ±ÅŸ YapÄ±lÄ±yor',
                text: "Oturumu kapatmak istediÄŸinize emin misiniz?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#d33',   // KÄ±rmÄ±zÄ±
                cancelButtonColor: '#3085d6', // Mavi
                confirmButtonText: 'Evet, Ã‡Ä±kÄ±ÅŸ Yap',
                cancelButtonText: 'Ä°ptal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // HoÅŸÃ§akal MesajÄ±
                    let timerInterval;
                    Swal.fire({
                        title: 'GÃ¼le GÃ¼le!',
                        html: 'Oturum kapatÄ±lÄ±yor...',
                        timer: 1000,
                        timerProgressBar: true,
                        didOpen: () => {
                            Swal.showLoading()
                        },
                        willClose: () => {
                            sessionStorage.clear();
                            window.location.href = "index.html";
                        }
                    });
                }
            });
        }

       // --- SAYFA AÃ‡ILINCA Ã‡ALIÅžACAK AYARLAR ---
        // Bu kod bloÄŸunu script'in en altÄ±na ekleyerek sayfa aÃ§Ä±lÄ±ÅŸÄ±nda tarihleri dolduruyoruz.
        async function sayfaHazirlik() {
            // 1. Tarihleri Ayarla (Bu AyÄ±n BaÅŸÄ± ve Sonu)
            const bugun = new Date();
            const ayinIlkGunu = new Date(bugun.getFullYear(), bugun.getMonth(), 1).toISOString().split('T')[0];
            const ayinSonGunu = new Date(bugun.getFullYear(), bugun.getMonth() + 1, 0).toISOString().split('T')[0];

            const baslangicInput = document.getElementById("baslangicTarih");
            const bitisInput = document.getElementById("bitisTarih");

            if(baslangicInput) baslangicInput.value = ayinIlkGunu;
            if(bitisInput) bitisInput.value = ayinSonGunu;

            // 2. Rapor Filtresindeki Ã–ÄŸretmenleri Doldur
            const q = query(collection(db, "kullanicilar"), where("rol", "==", "ogretmen"));
            const snapshot = await getDocs(q);
            const select = document.getElementById("filtreAd");
            if(select) {
                select.innerHTML = "<option value=''>TÃ¼m Ã–ÄŸretmenler</option>";
                snapshot.forEach(doc => {
                    select.innerHTML += `<option value="${doc.data().ad_soyad}">${doc.data().ad_soyad}</option>`;
                });
            }
            
            // HazÄ±rlÄ±k bitince otomatik listele
            if(typeof raporGetir === 'function') raporGetir();
        }
        // Sayfa yÃ¼klenince Ã§alÄ±ÅŸtÄ±r
        sayfaHazirlik();


        // --- GELÄ°ÅžMÄ°Åž RAPORLAMA FONKSÄ°YONU ---
        window.raporGetir = async function() {
            const adKutusu = document.getElementById("filtreAd");
            const baslangicKutusu = document.getElementById("baslangicTarih");
            const bitisKutusu = document.getElementById("bitisTarih");
            const tablo = document.getElementById("raporTablo");

            if (!tablo) return;

            // Select'ten deÄŸeri al (Ad Soyad veya BoÅŸ)
            const secilenOgretmen = adKutusu ? adKutusu.value : "";
            const baslangic = baslangicKutusu ? baslangicKutusu.value : "";
            const bitis = bitisKutusu ? bitisKutusu.value : "";

            tablo.innerHTML = "<tr><td colspan='7'>YÃ¼kleniyor...</td></tr>";
            
            try {
                const q = query(collection(db, "ders_kayitlari"), where("durum", "==", "onaylandi"), orderBy("tarih", "desc"));
                const snapshot = await getDocs(q);
                let html = "";
                let genelToplam = 0;

                snapshot.forEach((docSnap) => {
                    const veri = docSnap.data();
                    const id = docSnap.id;
                    
                    // Filtreleme
                    if (secilenOgretmen && veri.ogretmen_adi !== secilenOgretmen) return;
                    if (baslangic && veri.tarih < baslangic) return;
                    if (bitis && veri.tarih > bitis) return;
                    
                    const fiyat = veri.birim_fiyat || 0;
                    const tutar = veri.sure * fiyat;
                    genelToplam += veri.sure;

                    html += `<tr>
                        <td>${veri.tarih}</td>
                        <td>${veri.ogretmen_adi}</td>
                        <td>${veri.ders_tipi}</td>
                        <td class="fw-bold">${veri.sure} Saat</td>
                        <td>${fiyat} â‚º</td>
                        <td class="text-success fw-bold">${tutar} â‚º</td>
                        <td>
                            <div class="btn-group" role="group">
                                <button onclick="window.dersDuzenle('${id}', '${veri.sure}')" class="btn btn-outline-warning btn-sm" title="Saati DÃ¼zenle"><i class="bi bi-pencil"></i></button>
                                <button onclick="window.dersReddet('${id}')" class="btn btn-outline-secondary btn-sm" title="Reddet (Geri GÃ¶nder)"><i class="bi bi-arrow-counterclockwise"></i></button>
                                <button onclick="window.dersSil('${id}')" class="btn btn-outline-danger btn-sm" title="Tamamen Sil"><i class="bi bi-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;
                });
                tablo.innerHTML = html || "<tr><td colspan='7'>KayÄ±t yok.</td></tr>";
                
                const toplamKutu = document.getElementById("toplamSure");
                if(toplamKutu) toplamKutu.innerText = genelToplam;

            } catch (error) {
                console.log("Rapor hatasÄ±:", error);
                tablo.innerHTML = "<tr><td colspan='7' class='text-danger'>Hata oluÅŸtu.</td></tr>";
            }
        }

        // --- RAPOR Ä°ÅžLEM BUTONLARI (MODERN GÃ–RÃœNÃœM) ---
        
        // 1. Dersi Reddet (Modern Onay Kutusu ile)
        window.dersReddet = async function(id) {
            Swal.fire({
                title: 'Dersi Reddet?',
                text: "Bu ders kaydÄ± 'Onay Bekleyenler' listesine geri gÃ¶nderilecek.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#6c757d', // Gri buton
                cancelButtonColor: '#d33',     // KÄ±rmÄ±zÄ± buton
                confirmButtonText: 'Evet, Geri GÃ¶nder',
                cancelButtonText: 'Ä°ptal'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        await updateDoc(doc(db, "ders_kayitlari", id), { durum: "bekliyor" });
                        Swal.fire('Ä°ÅŸlem Tamam', 'Ders onayÄ± kaldÄ±rÄ±ldÄ±, bekleyenlere dÃ¼ÅŸtÃ¼.', 'success');
                        raporGetir(); // Listeyi yenile
                    } catch (e) {
                        Swal.fire('Hata', e.message, 'error');
                    }
                }
            });
        }

        // 2. Dersi Sil (Modern UyarÄ± Kutusu ile)
        window.dersSil = async function(id) {
            Swal.fire({
                title: 'Tamamen Silinsin mi?',
                text: "Bu iÅŸlem geri alÄ±namaz! KayÄ±t kalÄ±cÄ± olarak silinecek.",
                icon: 'error', // KÄ±rmÄ±zÄ± Ã§arpÄ± ikonu
                showCancelButton: true,
                confirmButtonColor: '#d33', // KÄ±rmÄ±zÄ± buton
                cancelButtonColor: '#3085d6', // Mavi buton
                confirmButtonText: 'Evet, Sil!',
                cancelButtonText: 'VazgeÃ§'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        await deleteDoc(doc(db, "ders_kayitlari", id));
                        Swal.fire('Silindi!', 'Ders kaydÄ± baÅŸarÄ±yla silindi.', 'success');
                        raporGetir();
                    } catch (e) {
                        Swal.fire('Hata', e.message, 'error');
                    }
                }
            });
        }

        // 3. Dersi DÃ¼zenle (SÄ°ZÄ°N Ä°STEDÄ°ÄžÄ°NÄ°Z KISIM - Modern Input Kutusu)
        window.dersDuzenle = async function(id, eskiSure) {
            const { value: yeniSure } = await Swal.fire({
                title: 'Ders SÃ¼resini DÃ¼zenle',
                input: 'number', // SayÄ± giriÅŸi olacak
                inputLabel: 'Yeni sÃ¼reyi giriniz (Saat)',
                inputValue: eskiSure, // Kutuda mevcut sÃ¼re yazsÄ±n
                showCancelButton: true,
                confirmButtonText: 'GÃ¼ncelle',
                cancelButtonText: 'Ä°ptal',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Bir sÃ¼re yazmanÄ±z gerekiyor!';
                    }
                }
            });

            if (yeniSure) {
                try {
                    await updateDoc(doc(db, "ders_kayitlari", id), { sure: parseInt(yeniSure) });
                    Swal.fire({
                        icon: 'success',
                        title: 'GÃ¼ncellendi',
                        showConfirmButton: false,
                        timer: 1500
                    });
                    raporGetir();
                } catch (e) {
                    Swal.fire('Hata', e.message, 'error');
                }
            }
        }

        // --- MUHASEBE FONKSÄ°YONLARI (YENÄ°) ---
        
        // 1. Ã–ÄŸretmenleri Listeye Doldur
        async function ogretmenleriYukle() {
            const q = query(collection(db, "kullanicilar"), where("rol", "==", "ogretmen"));
            const snapshot = await getDocs(q);
            const select = document.getElementById("muhasebeOgretmen");
            select.innerHTML = "<option value=''>SeÃ§iniz...</option>";
            snapshot.forEach(doc => {
                select.innerHTML += `<option value="${doc.data().ad_soyad}">${doc.data().ad_soyad}</option>`;
            });
        }
        ogretmenleriYukle(); // Sayfa aÃ§Ä±lÄ±nca Ã§alÄ±ÅŸtÄ±r

        

        // 1. Hesap Ã–zeti ve Hareketleri Getir (GÃœNCELLENDÄ°: TABLO FORMATI)
        window.hesapOzetiniGetir = async function() {
            const ogretmenAdi = document.getElementById("muhasebeOgretmen").value;
            const tabloBody = document.getElementById("hareketListesi"); // ArtÄ±k tbody
            
            if(!ogretmenAdi) {
                tabloBody.innerHTML = "<tr><td colspan='4' class='text-muted'>Ã–ÄŸretmen seÃ§iniz...</td></tr>";
                return;
            }

            document.getElementById("lblKalan").innerText = "HesaplanÄ±yor...";
            
            try {
                // A. Derslerden KazandÄ±ÄŸÄ±
                const qDers = query(collection(db, "ders_kayitlari"), where("ogretmen_adi", "==", ogretmenAdi), where("durum", "==", "onaylandi"));
                const dersSnap = await getDocs(qDers);
                let toplamHakEdis = 0;
                
                dersSnap.forEach(doc => {
                    const veri = doc.data();
                    const fiyat = veri.birim_fiyat || 0; 
                    toplamHakEdis += (veri.sure * fiyat);
                });

                // B. Ã–demeleri Listele
                const qOdeme = query(collection(db, "odemeler"), where("ogretmen_adi", "==", ogretmenAdi));
                const odemeSnap = await getDocs(qOdeme);
                let toplamOdenen = 0;
                let tabloHTML = "";
                let odemelerDizisi = [];

                odemeSnap.forEach(doc => { odemelerDizisi.push({ id: doc.id, ...doc.data() }); });
                
                // Tarihe gÃ¶re sÄ±rala (Yeniden eskiye)
                odemelerDizisi.sort((a, b) => new Date(b.tarih) - new Date(a.tarih));

                if(odemelerDizisi.length === 0) {
                    tabloHTML = "<tr><td colspan='4' class='text-muted'>HenÃ¼z Ã¶deme kaydÄ± yok.</td></tr>";
                } else {
                    odemelerDizisi.forEach(veri => {
                        toplamOdenen += parseFloat(veri.miktar);
                        
                        // TABLO SATIRI OLUÅžTURMA
                        tabloHTML += `
                        <tr>
                            <td>${tarihFormatla(veri.tarih)}</td>
                            <td class="text-start">${veri.aciklama}</td>
                            <td class="fw-bold text-success">${veri.miktar} â‚º</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button onclick="window.odemeDuzenle('${veri.id}', '${veri.miktar}', '${veri.aciklama}')" class="btn btn-outline-primary" title="DÃ¼zenle"><i class="bi bi-pencil"></i></button>
                                    <button onclick="window.odemeSil('${veri.id}')" class="btn btn-outline-danger" title="Sil"><i class="bi bi-trash"></i></button>
                                </div>
                            </td>
                        </tr>`;
                    });
                }

                // C. Ekrana Bas
                const kalanBakiye = toplamHakEdis - toplamOdenen;
                document.getElementById("lblHakedis").innerText = toplamHakEdis + " â‚º";
                document.getElementById("lblOdenen").innerText = toplamOdenen + " â‚º";
                document.getElementById("lblKalan").innerText = kalanBakiye + " â‚º";
                
                tabloBody.innerHTML = tabloHTML;

                // Formu HazÄ±rla
                document.getElementById("odemeTarih").valueAsDate = new Date();
                if(kalanBakiye > 0) document.getElementById("odemeMiktar").value = kalanBakiye;
                else document.getElementById("odemeMiktar").value = "";

            } catch (error) {
                console.error(error);
                alert("Hesaplama hatasÄ±: " + error.message);
            }
        }

        window.ekstreYazdir = async function() {
            const ogretmen = document.getElementById("muhasebeOgretmen").value;
            if(!ogretmen) return alert("LÃ¼tfen Ã¶nce bir Ã¶ÄŸretmen seÃ§in.");

            // Bilgileri Doldur
            document.getElementById("ekstreAd").innerText = ogretmen;
            document.getElementById("ekstreTarih").innerText = new Date().toLocaleDateString('tr-TR');
            document.getElementById("printHakedis").innerText = document.getElementById("lblHakedis").innerText;
            document.getElementById("printOdenen").innerText = document.getElementById("lblOdenen").innerText;
            document.getElementById("printKalan").innerText = document.getElementById("lblKalan").innerText;

            // Tabloyu Kopyala ve DÃ¼zenle
            const anaTablo = document.getElementById("hareketListesi").innerHTML;
            let temizTablo = anaTablo
                .replace(/<td>\s*<div class="btn-group[\s\S]*?<\/div>\s*<\/td>/g, "") // ButonlarÄ± sil
                .replace(/<td class="fw-bold text-success">/g, '<td class="text-end-print fw-bold">'); // TutarÄ± saÄŸa yasla

            document.getElementById("ekstreTabloBody").innerHTML = temizTablo;

            // YazdÄ±r
            const alan = document.getElementById("ekstreAlani");
            alan.classList.remove("d-none");
            window.print();
            alan.classList.add("d-none");
        }
// YERÄ°NE KONULACAK KOD BÄ°TÄ°ÅžÄ°

        // YardÄ±mcÄ± Fonksiyon: Tarih Formatla (YYYY-MM-DD -> DD.MM.YYYY)
        function tarihFormatla(tarihStr) {
            if(!tarihStr) return "";
            const p = tarihStr.split("-");
            return `${p[2]}.${p[1]}.${p[0]}`;
        }

        // YARDIMCI FONKSÄ°YON: SayÄ±yÄ± YazÄ±ya Ã‡evirir
        function sayiyiYaziyaCevir(sayi) {
            let s = Math.floor(sayi);
            if (s == 0) return "SIFIR TL";
            
            const birler = ["", "BÄ°R", "Ä°KÄ°", "ÃœÃ‡", "DÃ–RT", "BEÅž", "ALTI", "YEDÄ°", "SEKÄ°Z", "DOKUZ"];
            const onlar = ["", "ON", "YÄ°RMÄ°", "OTUZ", "KIRK", "ELLÄ°", "ALTMIÅž", "YETMÄ°Åž", "SEKSEN", "DOKSAN"];
            const basamaklar = ["", "BÄ°N", "MÄ°LYON"];
            
            let sonuc = "";
            let grupSayisi = 0;
            
            while (s > 0) {
                let grup = s % 1000;
                if (grup > 0) {
                    let grupYazi = "";
                    let yuzler = Math.floor(grup / 100);
                    let on = Math.floor((grup % 100) / 10);
                    let bir = grup % 10;
                    
                    if (yuzler > 0) grupYazi += (yuzler > 1 ? birler[yuzler] + " " : "") + "YÃœZ ";
                    if (on > 0) grupYazi += onlar[on] + " ";
                    if (bir > 0) {
                        // "Bir Bin" denmez, sadece "Bin" denir kontrolÃ¼
                        if (!(grupSayisi == 1 && grup == 1)) {
                            grupYazi += birler[bir] + " ";
                        }
                    }
                    sonuc = grupYazi + basamaklar[grupSayisi] + " " + sonuc;
                }
                s = Math.floor(s / 1000);
                grupSayisi++;
            }
            return sonuc.trim() + " TÃœRK LÄ°RASI";
        }

        // GÃœNCELLENMÄ°Åž VE DÃœZELTÄ°LMÄ°Åž Ã–DEME YAP FONKSÄ°YONU
        window.odemeYap = async function() {
            const ogretmen = document.getElementById("muhasebeOgretmen").value;
            const miktar = document.getElementById("odemeMiktar").value;
            const aciklama = document.getElementById("odemeAciklama").value;
            const tarih = document.getElementById("odemeTarih").value;

            // EÄŸer eksik bilgi varsa yine ÅŸÄ±k uyarÄ± verelim
            if(!ogretmen || !miktar || !tarih) {
                return Swal.fire({
                    icon: 'warning',
                    title: 'Eksik Bilgi',
                    text: 'LÃ¼tfen tarih, tutar ve Ã¶ÄŸretmen seÃ§iniz.'
                });
            }

            try {
                // 1. Firebase'e kaydet
                await addDoc(collection(db, "odemeler"), {
                    ogretmen_adi: ogretmen,
                    miktar: parseFloat(miktar),
                    aciklama: aciklama,
                    tarih: tarih
                });

                // 2. Makbuz Bilgilerini HazÄ±rla (YazdÄ±rmadan Ã¶nce verileri dolduruyoruz)
                document.getElementById("mkbAd").innerText = ogretmen;
                
                const trTarih = tarih.split("-").reverse().join(".");
                document.getElementById("mkbTarih").innerText = trTarih;
                
                document.getElementById("mkbAciklama").innerText = aciklama || "Ã–deme";
                document.getElementById("mkbTutar").innerText = miktar;
                document.getElementById("mkbYazi").innerText = sayiyiYaziyaCevir(parseFloat(miktar));
                
                // Formu Temizle
                document.getElementById("odemeMiktar").value = "";
                document.getElementById("odemeAciklama").value = "";

                // 3. Ã–NCE BAÅžARILI MESAJINI GÃ–STER, SONRA YAZDIR
                Swal.fire({
                    position: 'center',
                    icon: 'success',
                    title: 'Ã–deme Kaydedildi',
                    text: 'Makbuz hazÄ±rlanÄ±yor...',
                    showConfirmButton: false,
                    timer: 1500 // 1.5 saniye bekle
                }).then(() => {
                    // Bu kÄ±sÄ±m mesaj kapanÄ±nca Ã§alÄ±ÅŸÄ±r
                    const makbuzDiv = document.getElementById("makbuzAlani");
                    makbuzDiv.classList.remove("d-none"); // Makbuzu gÃ¶rÃ¼nÃ¼r yap
                    window.print(); // YazdÄ±r penceresini aÃ§
                    makbuzDiv.classList.add("d-none"); // Tekrar gizle
                    
                    hesapOzetiniGetir(); // Listeyi gÃ¼ncelle
                });

            } catch (error) {
                Swal.fire('Hata', error.message, 'error');
                console.error(error);
            }
        }
        

       // YENÄ° MODERN SÄ°LME FONKSÄ°YONU (SweetAlert2 ile)
        window.odemeSil = function(id) {
            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu Ã¶deme kaydÄ± tamamen silinecek! Bakiye deÄŸiÅŸecektir.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',   // Silme butonu kÄ±rmÄ±zÄ± olsun
                cancelButtonColor: '#3085d6', // Ä°ptal butonu mavi olsun
                confirmButtonText: 'Evet, Sil!',
                cancelButtonText: 'VazgeÃ§'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // KullanÄ±cÄ± Evet derse silme iÅŸlemini yap
                        await deleteDoc(doc(db, "odemeler", id));
                        
                        // BaÅŸarÄ±lÄ± kutucuÄŸu gÃ¶ster
                        Swal.fire(
                            'Silindi!',
                            'Ã–deme kaydÄ± baÅŸarÄ±yla silindi.',
                            'success'
                        );
                        
                        // Listeyi yenile
                        hesapOzetiniGetir();
                    } catch (error) {
                        Swal.fire('Hata', error.message, 'error');
                    }
                }
            });
        }
// --- YENÄ° MODERN DÃœZENLEME FONKSÄ°YONU ---
        window.odemeDuzenle = async function(id, eskiMiktar, eskiAciklama) {
            
            // Tek pencerede iki input alanÄ± oluÅŸturuyoruz
            const { value: formValues } = await Swal.fire({
                title: 'Ã–deme Bilgilerini DÃ¼zenle',
                html: `
                    <div style="text-align: left;">
                        <label class="fw-bold text-muted small mb-1">Tutar (TL)</label>
                        <input id="swal-input1" class="swal2-input m-0 mb-3 w-100" type="number" value="${eskiMiktar}">
                        
                        <label class="fw-bold text-muted small mb-1">AÃ§Ä±klama</label>
                        <input id="swal-input2" class="swal2-input m-0 w-100" type="text" value="${eskiAciklama}">
                    </div>
                `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Kaydet',
                cancelButtonText: 'VazgeÃ§',
                confirmButtonColor: '#0d6efd', // Mavi buton
                preConfirm: () => {
                    return [
                        document.getElementById('swal-input1').value,
                        document.getElementById('swal-input2').value
                    ]
                }
            });

            // EÄŸer kullanÄ±cÄ± Kaydet'e bastÄ±ysa
            if (formValues) {
                const [yeniMiktar, yeniAciklama] = formValues;

                // Tutar boÅŸ mu kontrol et
                if(!yeniMiktar) return Swal.fire("Hata", "Tutar boÅŸ bÄ±rakÄ±lamaz!", "error");

                try {
                    // Firebase GÃ¼ncelleme
                    await updateDoc(doc(db, "odemeler", id), {
                        miktar: parseFloat(yeniMiktar),
                        aciklama: yeniAciklama
                    });

                    // BaÅŸarÄ±lÄ± MesajÄ±
                    Swal.fire({
                        icon: 'success',
                        title: 'GÃ¼ncellendi!',
                        text: 'Ã–deme kaydÄ± baÅŸarÄ±yla dÃ¼zeltildi.',
                        timer: 1500,
                        showConfirmButton: false
                    });

                    // Tabloyu Yenile
                    hesapOzetiniGetir();

                } catch (error) {
                    Swal.fire('Hata', error.message, 'error');
                }
            }
        }

        // --- PERSONEL YÃ–NETÄ°MÄ° (ÅžÄ°FRE BUTONU EKLENDÄ°) ---
        onSnapshot(collection(db, "kullanicilar"), (snapshot) => {
            const liste = document.getElementById("kullaniciListesi");
            liste.innerHTML = "";
            snapshot.forEach(docSnap => {
                const user = docSnap.data();
                const ucret = user.saat_ucreti ? user.saat_ucreti + " TL/Saat" : "Ãœcret Yok";
                const rolRozet = user.rol === 'yonetici' ? '<span class="badge bg-danger">YÃ¶netici</span>' : '<span class="badge bg-primary">Ã–ÄŸretmen</span>';
                
                liste.innerHTML += `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div><strong>${user.ad_soyad}</strong> ${rolRozet}<br><small class="text-muted">${user.email} | ${ucret}</small></div>
                    <div class="btn-group">
                        <button onclick="window.modalAc('${docSnap.id}', '${user.ad_soyad}', '${user.saat_ucreti||0}', '${user.rol}')" class="btn btn-outline-warning btn-sm" title="DÃ¼zenle"><i class="bi bi-pencil-square"></i></button>
                        <button onclick="window.sifreModalAc('${docSnap.id}')" class="btn btn-outline-info btn-sm" title="Åžifre DeÄŸiÅŸtir"><i class="bi bi-key"></i></button>
                        <button onclick="window.kullaniciSil('${docSnap.id}')" class="btn btn-outline-danger btn-sm" title="Sil"><i class="bi bi-trash"></i></button>
                    </div>
                </li>`;
            });
        });

        // --- YENÄ° PERSONEL EKLEME (MODERN TASARIM) ---
        const formPersonel = document.getElementById("personelForm");
        
        if (formPersonel) {
            formPersonel.addEventListener("submit", async (e) => {
                e.preventDefault();
                
                // Butona "Ekleniyor..." efekti verelim
                const btn = formPersonel.querySelector("button[type='submit']");
                const orjinalMetin = btn.innerHTML;
                btn.innerHTML = "Ekleniyor...";
                btn.disabled = true;

                try {
                    // VeritabanÄ±na Kaydet
                    await addDoc(collection(db, "kullanicilar"), {
                        ad_soyad: document.getElementById("yeniAd").value,
                        email: document.getElementById("yeniEmail").value,
                        sifre: document.getElementById("yeniSifre").value,
                        saat_ucreti: parseFloat(document.getElementById("yeniUcret").value) || 0,
                        rol: document.getElementById("yeniRol").value,
                        olusturulma: new Date()
                    });
                    
                    // Formu Temizle
                    formPersonel.reset();

                    // BAÅžARILI MESAJI (MODERN)
                    Swal.fire({
                        position: 'center',
                        icon: 'success',
                        title: 'Personel Eklendi',
                        text: 'Yeni Ã§alÄ±ÅŸan baÅŸarÄ±yla sisteme kaydedildi.',
                        showConfirmButton: false,
                        timer: 1500
                    });
                    
                    // Listeleri GÃ¼ncelle
                    if(typeof ogretmenleriYukle === 'function') ogretmenleriYukle();

                } catch (error) {
                    // Hata MesajÄ±
                    Swal.fire('Hata', error.message, 'error');
                } finally {
                    // Butonu eski haline getir
                    btn.innerHTML = orjinalMetin;
                    btn.disabled = false;
                }
            });
        }
       // --- KULLANICI DÃœZENLEME FONKSÄ°YONLARI (GÃœNCELLENDÄ°) ---
        window.modalAc = function(id, ad, ucret, rol) {
            // 1. DeÄŸerleri Kutulara Doldur
            document.getElementById('editId').value = id;
            document.getElementById('editAd').value = ad;
            document.getElementById('editUcret').value = ucret;
            document.getElementById('editRol').value = rol;

            // 2. ModalÄ± GÃ¼venli Åžekilde AÃ§ (Hata vermez)
            const modalEl = document.getElementById('duzenleModal');
            const modalInstance = bootstrap.Modal.getOrCreateInstance(modalEl); 
            modalInstance.show();
        }

        

        window.kullaniciGuncelle = async function() {
            const id = document.getElementById('editId').value;
            await updateDoc(doc(db, "kullanicilar", id), {
                ad_soyad: document.getElementById('editAd').value,
                saat_ucreti: parseFloat(document.getElementById('editUcret').value),
                rol: document.getElementById('editRol').value
            });
            editModal.hide();
            alert("GÃ¼ncellendi!");
        }
        
        // --- PERSONEL SÄ°LME Ä°ÅžLEMÄ° (MODERN GÃ–RÃœNÃœM) ---
        window.kullaniciSil = async function(id) {
            Swal.fire({
                title: 'KullanÄ±cÄ± Silinsin mi?',
                text: "Bu iÅŸlem geri alÄ±namaz! KiÅŸi sisteme bir daha giriÅŸ yapamayacak.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',   // KÄ±rmÄ±zÄ± (Tehlikeli iÅŸlem rengi)
                cancelButtonColor: '#3085d6', // Mavi (VazgeÃ§ rengi)
                confirmButtonText: 'Evet, Sil!',
                cancelButtonText: 'VazgeÃ§'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // VeritabanÄ±ndan silme iÅŸlemi
                        await deleteDoc(doc(db, "kullanicilar", id));
                        
                        // BaÅŸarÄ±lÄ± mesajÄ±
                        Swal.fire(
                            'Silindi!',
                            'KullanÄ±cÄ± baÅŸarÄ±yla silindi.',
                            'success'
                        );
                    } catch (error) {
                        Swal.fire('Hata', error.message, 'error');
                    }
                }
            });
        }
        
        // --- 1. ONAY Ä°ÅžLEMLERÄ° VE BÄ°LDÄ°RÄ°M (YENÄ° HALÄ°) ---
        let ilkYukleme = true; 
        
        // Not: EÄŸer Console'da index hatasÄ± verirse linke tÄ±klayÄ±p oluÅŸturun
        const qBekleyen = query(collection(db, "ders_kayitlari"), where("durum", "==", "bekliyor"), orderBy("tarih", "desc"));
        
        onSnapshot(qBekleyen, (snapshot) => {
            const tablo = document.getElementById("bekleyenTablo");
            const badge = document.getElementById("badgeSayi");
            if(badge) badge.innerText = snapshot.docs.length; 
            
            if(tablo) {
                tablo.innerHTML = "";
                if (snapshot.docs.length === 0) { 
                    tablo.innerHTML = `<tr><td colspan="5" class="p-4 text-muted">Bekleyen onay yok. ðŸŽ‰</td></tr>`; 
                }

                // A. Tabloyu Doldur
                snapshot.docs.forEach(docSnap => {
                    const veri = docSnap.data();
                    tablo.innerHTML += `<tr>
                        <td class="fw-bold">${veri.ogretmen_adi}</td>
                        <td>${veri.tarih}</td>
                        <td>${veri.ders_tipi}</td>
                        <td>${veri.sure} Saat</td>
                        <td>
                            <button onclick="window.onayIslemi('${docSnap.id}', 'onaylandi')" class="btn btn-success btn-sm me-1">Onayla</button>
                            <button onclick="window.onayIslemi('${docSnap.id}', 'reddedildi')" class="btn btn-danger btn-sm">Reddet</button>
                        </td>
                    </tr>`;
                });
            }

            // B. SES VE BÄ°LDÄ°RÄ°M KISMI
            if (!ilkYukleme) {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "added") {
                        // Sesi Ã‡al
                        const ses = document.getElementById("bildirimSesi");
                        if(ses) ses.play().catch(e => console.log("Ses Ã§alma hatasÄ±:", e));

                        // Kutuyu GÃ¶ster
                        const yeniVeri = change.doc.data();
                        const bildirimMetni = document.getElementById("bildirimMetni");
                        const bildirimKutusu = document.getElementById("canliBildirim");
                        
                        if(bildirimMetni && bildirimKutusu) {
                            bildirimMetni.innerText = `${yeniVeri.ogretmen_adi} yeni bir ders girdi!`;
                            const toast = new bootstrap.Toast(bildirimKutusu);
                            toast.show();
                        }
                    }
                });
            }
            ilkYukleme = false;
        });
       // --- MODERN ONAY VE REDDETME Ä°ÅžLEMÄ° ---
        window.onayIslemi = async function(id, durum) {
            // Ä°ÅŸlem tÃ¼rÃ¼ne gÃ¶re renk ve metin belirleyelim
            const isApproved = durum === 'onaylandi';
            
            Swal.fire({
                title: isApproved ? 'Dersi Onayla?' : 'Dersi Reddet?',
                text: isApproved 
                    ? "Bu ders kaydÄ± onaylanacak ve Ã¶ÄŸretmenin bakiyesine eklenecek." 
                    : "Bu ders kaydÄ± reddedilecek.",
                icon: isApproved ? 'question' : 'warning',
                showCancelButton: true,
                confirmButtonColor: isApproved ? '#198754' : '#dc3545', // YeÅŸil veya KÄ±rmÄ±zÄ±
                cancelButtonColor: '#6c757d',
                confirmButtonText: isApproved ? 'Evet, Onayla' : 'Evet, Reddet',
                cancelButtonText: 'Ä°ptal'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // VeritabanÄ±nÄ± GÃ¼ncelle
                        await updateDoc(doc(db, "ders_kayitlari", id), { durum: durum });
                        
                        // KÄ±sa bir baÅŸarÄ± mesajÄ± gÃ¶ster (1 saniye sonra kaybolur)
                        Swal.fire({
                            position: 'center',
                            icon: 'success',
                            title: 'Ä°ÅŸlem BaÅŸarÄ±lÄ±',
                            showConfirmButton: false,
                            timer: 1000
                        });
                    } catch (error) {
                        Swal.fire('Hata', error.message, 'error');
                    }
                }
            });
        }
        
        // 1. ModalÄ± AÃ§an Fonksiyon
        const sifreModalElement = new bootstrap.Modal(document.getElementById('sifreModal'));
        
        window.sifreModalAc = function(id) {
            document.getElementById('sifreDegisecekId').value = id; // ID'yi sakla
            document.getElementById('yeniSifreInput').value = "";   // Kutuyu temizle
            sifreModalElement.show(); // Pencereyi aÃ§
        }

        // --- ÅžÄ°FRE GÃœNCELLEME (MODERN TASARIM) ---
        window.sifreGuncelle = async function() {
            const id = document.getElementById('sifreDegisecekId').value;
            const yeniSifre = document.getElementById('yeniSifreInput').value;

            // 1. Åžifre BoÅŸsa Uyar
            if (!yeniSifre) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Eksik Bilgi',
                    text: 'LÃ¼tfen yeni bir ÅŸifre girin!',
                    confirmButtonText: 'Tamam'
                });
                return;
            }

            try {
                // 2. Firebase GÃ¼ncelleme Ä°ÅŸlemi
                await updateDoc(doc(db, "kullanicilar", id), {
                    sifre: yeniSifre
                });

                // 3. ModalÄ± Kapat
                sifreModalElement.hide(); 

                // 4. BAÅžARILI MESAJI (MODERN)
                Swal.fire({
                    position: 'center',
                    icon: 'success',
                    title: 'Åžifre GÃ¼ncellendi',
                    text: 'KullanÄ±cÄ±nÄ±n ÅŸifresi baÅŸarÄ±yla deÄŸiÅŸtirildi.',
                    showConfirmButton: false,
                    timer: 1500
                });

            } catch (error) {
                Swal.fire('Hata', error.message, 'error');
            }
        }
        // --- KULLANICI GÃœNCELLEME (KAYDETME) FONKSÄ°YONU ---
        window.kullaniciGuncelle = async function() {
            // 1. Formdaki verileri al
            const id = document.getElementById('editId').value;
            const yeniAd = document.getElementById('editAd').value;
            const yeniUcret = document.getElementById('editUcret').value;
            const yeniRol = document.getElementById('editRol').value;

            // 2. Hata kontrolÃ¼ (ID yoksa iÅŸlem yapma)
            if (!id) {
                alert("Hata: KullanÄ±cÄ± ID'si bulunamadÄ±!");
                return;
            }

            const btn = document.querySelector("#duzenleModal .btn-primary");
            btn.innerHTML = "Kaydediliyor...";
            btn.disabled = true;

            try {
                // 3. VeritabanÄ±nÄ± GÃ¼ncelle
                // Not: 'kullanicilar' koleksiyonundaki 'id'li belgeyi bul ve deÄŸiÅŸtir
                const kullaniciRef = doc(db, "kullanicilar", id);
                
                await updateDoc(kullaniciRef, {
                    ad_soyad: yeniAd,
                    saat_ucreti: parseFloat(yeniUcret), // SayÄ±ya Ã§evir
                    rol: yeniRol
                });
                
                // 4. ModalÄ± (Pencereyi) Kapat
                const modalEl = document.getElementById('duzenleModal');
                const modalInstance = bootstrap.Modal.getInstance(modalEl);
                if (modalInstance) {
                    modalInstance.hide();
                }

                // 5. BaÅŸarÄ±lÄ± MesajÄ± Ver
                Swal.fire({
                    position: 'center',
                    icon: 'success',
                    title: 'BaÅŸarÄ±yla GÃ¼ncellendi',
                    showConfirmButton: false,
                    timer: 1500
                });

            } catch (error) {
                console.error("GÃ¼ncelleme HatasÄ±:", error);
                Swal.fire('Hata', 'GÃ¼ncelleme yapÄ±lamadÄ±: ' + error.message, 'error');
            } finally {
                // Butonu eski haline getir
                btn.innerHTML = "GÃ¼ncelle";
                btn.disabled = false;
            }
        }
    </script>
    <audio id="bildirimSesi" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.m4a" preload="auto"></audio>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="canliBildirim" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header bg-success text-white">
      <i class="bi bi-bell-fill me-2"></i>
      <strong class="me-auto">Yeni Ders Bildirimi</strong>
      <small>Åžimdi</small>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
    </div>
   
    <div class="toast-body fw-bold" id="bildirimMetni">
      Bir Ã¶ÄŸretmen yeni ders kaydÄ± girdi!
    </div>
  </div>
</div>
<div class="modal fade" id="sifreModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title text-dark">ðŸ”‘ Åžifre DeÄŸiÅŸtir</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="sifreDegisecekId">
                <div class="mb-3">
                    <label class="form-label">Yeni Åžifre</label>
                    <input type="text" id="yeniSifreInput" class="form-control" placeholder="Yeni ÅŸifreyi yazÄ±n...">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ä°ptal</button>
                <button onclick="sifreGuncelle()" class="btn btn-warning">Åžifreyi Kaydet</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="duzenleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">âœï¸ Bilgileri DÃ¼zenle</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editId">
                <div class="mb-3">
                    <label class="form-label">Ad Soyad</label>
                    <input type="text" id="editAd" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Saatlik Ãœcret (TL)</label>
                    <input type="number" id="editUcret" class="form-control">
                </div>
                <div class="mb-3">
                    <label class="form-label">Rol</label>
                    <select id="editRol" class="form-select">
                        <option value="ogretmen">Ã–ÄŸretmen</option>
                        <option value="yonetici">YÃ¶netici</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ä°ptal</button>
                <button onclick="kullaniciGuncelle()" class="btn btn-primary">GÃ¼ncelle</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>